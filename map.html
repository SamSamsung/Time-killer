<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/icons_map/sex_map.jpg">
    <link rel="stylesheet" href="./css/style.css"> <!-- On importe le document style.css pour  utiliser le css-->
    <link rel="stylesheet" href="./css/map.css"> <!-- On importe le document style.css pour  utiliser le css-->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" /> <!-- Barre de recherche CSS-->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script> <!-- Barre de recherche JS-->
    <script type="module" src="https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js"></script> <!-- Authentification JS-->
    <title>Map</title>
</head>
    <body>
        <div id="overlay"></div>
        <div class="pop_up" id="informations">
            <p>Qui est l'heureux¬∑se √©lu¬∑e ?</p>
            <p id="creator-name-display" class="popup-data-box" style="margin-top: 5px; text-align: center;"></p>
            <p>Partenaire¬∑s</p>
            <textarea id="partenaire" name="partenaire" rows="1" cols="15" style="resize: none;"></textarea>
            <p>Date</p>
            <input id="date" type="date"/>
            <p>Lieu</p>
            <textarea id="lieu" name="partenaire" rows="1" cols="15" style="resize: none;"></textarea>
            <p>Position¬∑s</p>
            <ul id="positions">
                <li><input type="checkbox" id="doggy-style" class="cb"/>
                  <label for="doggy-style" title="La levrette - Doggy style"><img src="icons_map/dog.png" /></label>
                </li>
                <li><input type="checkbox" id="lazy-doggy-style" class="cb"/>
                    <label for="lazy-doggy-style" title="L'union de l'√©l√©phant (Levrette allong√©e) - The Lazy doggy style"><img src="icons_map/anal.png" /></label>
                </li>
                <li><input type="checkbox" id="standing-doggy-style" class="cb"/>
                      <label for="standing-doggy-style" title="La vache (levrette debout) - The Standing doggy style"><img src="icons_map/doggy.png" /></label>
                </li>
                <li><input type="checkbox" id="missionary" class="cb" />
                  <label for="missionary" title="Missionaire - Missionary"><img src="icons_map/sex-2.png"></label>
                </li>
                <li><input type="checkbox" id="cowgirl" class="cb"/>
                  <label for="cowgirl" title="L'andromaque - Cowgirl"><img src="icons_map/cowgirl.png" /></label>
                </li>
                <li><input type="checkbox" id="cunnilingus" class="cb" />
                    <label for="cunnilingus" title="Le cunnilingus - The cunnilingus"><img src="icons_map/licking.png"></label>
                </li>
                <li><input type="checkbox" id="blowjob" class="cb"/>
                    <label for="blowjob" title="La fellation - The Blowjob"><img src="icons_map/oral-sex-2.png" /></label>
                </li>
                <li><input type="checkbox" id="lazy-blowjob" class="cb"/>
                    <label for="lazy-blowjob" title="La fellation allong√©e - The lazy Blowjob"><img src="icons_map/oral-sex.png" /></label>
                </li>
                <li><input type="checkbox" id="upstanding-citizen" class="cb" />
                    <label for="upstanding-citizen" title="L'Homme debout - The Upstanding citizen"><img src="icons_map/front.png"></label>
                </li>
                <li><input type="checkbox" id="reversed-cowgirl" class="cb"/>
                    <label for="reversed-cowgirl" title="L'andromaque invers√©e - Reversed cowgirl"><img src="icons_map/back.png" /></label>
                </li>
                <li><input type="checkbox" id="leapfrog" class="cb" />
                      <label for="leapfrog" title="La grenouille √† la nage - The Leapfrog"><img src="icons_map/back (1).png"></label>
                </li>
                <li><input type="checkbox" id="69" class="cb"/>
                      <label for="69" title="Le 69"><img src="icons_map/man.png" /></label>
                </li>
                <li><input type="checkbox" id="lotus" class="cb"/>
                      <label for="lotus" title="Le Totus - The Lotus"><img src="icons_map/sex.png" /></label>
                </li>
                <li><input type="checkbox" id="others" class="cb"/>
                    <label for="others" title="Autres..."><img src="icons_map/autre.png" /></label>
              </li>
            </ul>
            <p>Note</p>
            <div class="emoji-rating">
                <input type="radio" id="rating-1" name="rating" value="1" />
                <label for="rating-1" title="1/10 - Nul">ü§Æ</label>
        
                <input type="radio" id="rating-2" name="rating" value="2" />
                <label for="rating-2" title="2/10">ü´•</label>
        
                <input type="radio" id="rating-3" name="rating" value="3" />
                <label for="rating-3" title="3/10">ü•±</label>
        
                <input type="radio" id="rating-4" name="rating" value="4" />
                <label for="rating-4" title="4/10">üôÉ</label>
        
                <input type="radio" id="rating-5" name="rating" value="5" />
                <label for="rating-5" title="5/10">üòè</label>
        
                <input type="radio" id="rating-6" name="rating" value="6" />
                <label for="rating-6" title="6/10">üòã</label>
        
                <input type="radio" id="rating-7" name="rating" value="7" />
                <label for="rating-7" title="7/10">ü•¥</label>
        
                <input type="radio" id="rating-8" name="rating" value="8" />
                <label for="rating-8" title="8/10">üòç</label>
        
                <input type="radio" id="rating-9" name="rating" value="9" />
                <label for="rating-9" title="9/10">üòà</label>
        
                <input type="radio" id="rating-10" name="rating" value="10" />
                <label for="rating-10" title="10/10 - Meilleur">ü•µ</label>

                <input type="radio" id="rating-none" name="rating" value="none" checked/>
                <label for="rating-none" title="None - Pas de note">‚ùå</label>
            </div>
            <p>Commentaires</p>
            <textarea id="commentaires" name="commentaires" rows="5" cols="25"></textarea>
            <br>
            <button class="verif_button" style="background-color: lightgreen;" onclick="yes()">Enregistrer</button>
            <button class="verif_button" style="background-color: red;" onclick="pop_up_close()">Annuler</button>
        </div>


        <div class="pop_up" id="comments">
            <p>Vous etes connect√©¬∑es sous le pseudo : <b id="pseudo"></b></p>
            <p id="key" style="display: none;"></p>
            <p>Veuillez rajouter votre commentaire :</p>
            <textarea id="comment_box" name="comments" rows="3"></textarea>
            <br>
            <button class="verif_button" style="background-color: lightgreen;" onclick="yes_comments()">Enregistrer</button>
            <button class="verif_button" style="background-color: red;" onclick="pop_up_close_comments()">Annuler</button>
        </div>

        
        <div id="ui-container">
    
            <button id="locate-button" title="Me localiser">
                <img src="./icons_map/target.png" alt="Localiser">
                <span>Me localiser</span>
            </button>
            
            <button id="friends-button" title="G√©rer les amis">
                <img src="./icons_map/friends.png" alt="Amis"> 
                <span>G√©rer les amis</span>
                <span id="friend-request-badge" class="notification-badge"></span>
            </button>

            <button id="profile-button" title="Mon Profil">
                <img src="./icons_map/account.png" alt="Profil">
                <span>Mon Profil</span>
            </button>
            
            <button id="logout-button" title="D√©connexion">
                <img src="./icons_map/logout.png" alt="D√©connexion">
                <span>D√©connexion</span>
            </button>
        
        </div>
        
        <div id="map">
        </div>
        
        <!-- Popup de connexion (style identique √† tes autres popups) -->
        <div class="pop_up" id="login-popup">
            <h2>Connexion requise</h2>
            <p>Pour utiliser la carte, connecte-toi avec ton compte Google.</p>
            <button id="google-login-button" class="verif_button" style="background-color: #4285F4; color: white;">
                Se connecter avec Google
            </button>
        </div>

        <div class="pop_up" id="friends-popup">
            <h2>G√©rer les amis</h2>
            
            <div class="friend-section">
                <h3>Demandes en attente</h3>
                <div id="pending-friends-list">
                    </div>
            </div>
        
            <div class="friend-section">
                <h3>Chercher un utilisateur</h3>
                <div class="search-bar">
                    <input type="text" id="user-search-input" placeholder="Nom d'utilisateur...">
                    <button id="user-search-button">Rechercher</button>
                </div>
                <div id="user-search-results">
                    </div>
            </div>
            
            <div class="friend-section">
                <h3>Mes amis</h3>
                <div id="current-friends-list">
                    </div>
            </div>
            
            <button class="verif_button" style="background-color: red;" onclick="friends_pop_up_close()">Fermer</button>
        </div>

        <div class="pop_up" id="profile-popup" style="text-align: left; padding: 20px;">
            <h2>Mon Profil</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <img id="profile-icon-preview" src="./icons_map/boutique-de-sexe-black.png" 
                     style="width: 80px; height: 80px; object-fit: contain;">
            </div>
            
            <p class="header_popup" style="margin-top: 0;">Mon pseudo</p>
            <input type="text" id="profile-name-input" class="popup-data-box" style="width: 95%; font-size: 16px;">
            
            <p class="header_popup">Choisir mon ic√¥ne</p>
            <div id="icon-color-grid">
                </div>
            
            <br><br>
            
            <div style="text-align: right;">
                <button class="verif_button" style="background-color: red;" onclick="closeProfilePopup()">Annuler</button>
                <button class="verif_button" style="background-color: lightgreen;" onclick="saveProfile()">Enregistrer</button>
            </div>

            <div class="profile-attribution">
                Ic√¥nes con√ßues par 
                <a href="https://www.flaticon.com/fr/auteurs/freepik" title="Freepik">Freepik</a> 
                from 
                <a href="https://www.flaticon.com/fr/" title="Flaticon">www.flaticon.com</a>
            </div>
        </div>


       
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
            import { getDatabase, ref, push, set, get, onValue, remove, update, query, orderByChild, startAt, endAt } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
            import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, getAdditionalUserInfo, updateProfile } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
            
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
                apiKey: "AIzaSyBfc8bayndzKxerjww9pWcJf2t2rp_PwFM",
                authDomain: "my-map-acbca.firebaseapp.com",
                databaseURL: "https://my-map-acbca-default-rtdb.europe-west1.firebasedatabase.app",
                projectId: "my-map-acbca",
                storageBucket: "my-map-acbca.appspot.com",
                messagingSenderId: "103920017011",
                appId: "1:103920017011:web:d8c9591ea35b41dd741406"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getDatabase(app);


            // Expose the database reference to the global scope or use it directly in your script
            window.db = db;
            window.ref = ref;
            window.push = push;
            window.set = set;
            window.get = get;
            window.onValue = onValue;
            window.remove = remove;
            window.update = update;
            window.query = query;
            window.orderByChild = orderByChild;
            window.startAt = startAt;
            window.endAt = endAt;
            window.getAdditionalUserInfo = getAdditionalUserInfo;
            window.updateProfile = updateProfile;


            const auth = getAuth(app);
            const provider = new GoogleAuthProvider();
            window.auth = auth;
            window.onAuthStateChanged = onAuthStateChanged;
            window.signOut = signOut;
            window.signInWithPopup = signInWithPopup;
            window.provider = provider;
        </script>
        
        <script src="./scripts/script_map.js"></script>
        
    </body>
    
</html>
